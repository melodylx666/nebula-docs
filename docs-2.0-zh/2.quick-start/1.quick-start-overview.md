# 基于 Docker 快速部署

{{nebula.name}}  提供了基于 Docker 的快速部署方式，可以在几分钟内完成部署。

=== "使用 Docker Desktop"    

    按照以下步骤可以快速在 Docker Desktop 中部署 {{nebula.name}} 。

    1. 安装 [Docker Desktop](https://www.docker.com/products/docker-desktop/)。

      !!! caution

            不建议在 Windows 上使用 Docker Desktop，因为 Windows 上的 Docker Desktop 性能较差。详情请参见 [#12401](https://github.com/docker/for-win/issues/12401)。如果在 Windows 端安装 Docker Desktop 需[安装 WSL 2](https://docs.docker.com/desktop/install/windows-install/)。

    2. 在仪表盘中单击`Extensions`或`Add Extensions`打开Extensions Marketplace 搜索 {{nebula.name}} ，也可以点击 [{{nebula.name}} ](https://hub.docker.com/extensions/weygu/nebulagraph-dd-ext) 在 Docker Desktop 打开。
   
    3. 单击 **Install** 下载 {{nebula.name}} 。

      ![docker](https://docs-cdn.nebula-graph.com.cn/figures/docker.png)

      在有更新的时候，可以单击 **Update** 更新到最新版本。

      ![docker-update](https://docs-cdn.nebula-graph.com.cn/figures/docker-update.png)
    
    4. 单击 **Open**。
   
    5. 在页面顶部，单击 **Studio in Browser**。
   
    6. 使用基本 nGQL 语句。更多信息，请参见[使用常用 nGQL（CRUD 命令）](../../2.quick-start/3.quick-start-on-premise/4.nebula-graph-crud.md)。 

    视频介绍

    <iframe src="//player.bilibili.com/player.html?bvid=BV1NA411y7Uy&cid=1028726635&autoplay=0&page=1&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="720px" height="480px"> </iframe>
    

=== "使用 Docker Compose"

    使用 Docker Compose 可以基于准备好的配置文件快速部署 {{nebula.name}} 服务，仅建议在测试 {{nebula.name}} 功能时使用该方式。

    ## 前提条件

    - 主机上安装如下应用程序。

        | 应用程序 | 推荐版本 | 官方安装参考 |
        |:---|:---|:---|
        |Docker|最新版本|[Install Docker Engine](https://docs.docker.com/engine/install/) |
        |Docker Compose|最新版本|[Install Docker Compose](https://docs.docker.com/compose/install/)|
        |Git|最新版本|[Download Git](https://git-scm.com/download/)|

    - 如果使用非 root 用户部署 {{nebula.name}}，请授权该用户 Docker 相关的权限。详细信息，请参见 [Manage Docker as a non-root user](https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user)。

    - 启动主机上的 Docker 服务。

    - 如果已经通过 Docker Compose 在主机上部署了另一个版本的 {{nebula.name}}，为避免兼容性问题，需要删除目录`nebula-docker-compose/data`。

    ## 部署 {{nebula.name}} 

    1. 通过 Git 克隆`nebula-docker-compose`仓库的`{{dockercompose.release}}`分支到主机。

      !!! danger

            `master`分支包含最新的未测试代码。请**不要**在生产环境使用此版本。

        ```bash
        $ git clone -b {{dockercompose.branch}} https://github.com/vesoft-inc/nebula-docker-compose.git
        ```

      !!! note

            Docker Compose 的`x.y`版本对齐内核的`x.y`版本，对于内核`z`版本，Docker Compose 不会发布对应的`z`版本，但是会拉取`z`版本的内核镜像。

    2. 切换至目录`nebula-docker-compose`。

        ```bash
        $ cd nebula-docker-compose/
        ```

    3. 执行如下命令启动 {{nebula.name}} 服务。

      !!! note

            - 如果长期未内核更新镜像，请先更新 [{{nebula.name}} 镜像](#nebulagraph_docker)和 [NebulaGraph Console 镜像](#nebulagraph_console)。
            - 执行命令后的返回结果因安装目录不同而不同。

        ```bash
        [nebula-docker-compose]$ docker-compose up -d
        Creating nebula-docker-compose_metad0_1 ... done
        Creating nebula-docker-compose_metad2_1 ... done
        Creating nebula-docker-compose_metad1_1 ... done
        Creating nebula-docker-compose_storaged0_1 ... done
        Creating nebula-docker-compose_storaged1_1 ... done
        Creating nebula-docker-compose_storaged2_1 ... done
        ```

      !!! compatibility

            从 3.1 版本开始，Docker-compose 会自动启动 NebulaGraph Console 镜像的容器，并将 Storage 主机增加至集群中（即`ADD HOSTS`命令）。

      !!! note

            上述服务的更多信息，请参见[架构总览](../1.introduction/3.nebula-graph-architecture/1.architecture-overview.md)。

    ## 连接 {{nebula.name}} 

    连接 {{nebula.name}} 有两种方式：

    - 在容器外通过 Nebula Console 连接。因为容器的配置文件中将 Graph 服务的外部映射端口也固定为 9669，因此可以直接通过默认端口连接。详情参见[连接 {{nebula.name}} ](../2.quick-start/3.quick-start-on-premise/3.connect-to-nebula-graph.md)。

    - 登录安装了 NebulaGraph Console 的容器，然后再连接 Graph 服务。本小节介绍这种方式。

    1. 使用`docker-compose ps`命令查看 NebulaGraph Console 容器名称。

      ```bash
      $ docker-compose ps
                Name                         Command             State                 Ports
      ----------------------------------------------------------------------------------------------
      nebula-docker-compose_console_1     sh -c sleep 3 &&          Up
                                        nebula-co ...
      ......
      ```

    2. 进入 NebulaGraph Console 容器中。

      ```bash
      $ docker exec -it nebula-docker-compose_console_1 /bin/sh
      / #
      ```

    3. 通过 NebulaGraph Console 连接 {{nebula.name}} 。

      ```bash
      / # ./usr/local/bin/nebula-console -u <user_name> -p <password> --address=graphd --port=9669
      ```

      !!! note

            默认情况下，身份认证功能是关闭的，只能使用已存在的用户名（默认为`root`）和任意密码登录。如果想使用身份认证，请参见[身份认证](../7.data-security/1.authentication/1.authentication.md)。

    4. 查看集群状态。

      ```bash
      nebula> SHOW HOSTS;
      +-------------+------+----------+--------------+----------------------+------------------------+---------+
      | Host        | Port | Status   | Leader count | Leader distribution  | Partition distribution | Version |
      +-------------+------+----------+--------------+----------------------+------------------------+---------+
      | "storaged0" | 9779 | "ONLINE" | 0            | "No valid partition" | "No valid partition"   | "{{nebula.release}}" |
      | "storaged1" | 9779 | "ONLINE" | 0            | "No valid partition" | "No valid partition"   | "{{nebula.release}}" |
      | "storaged2" | 9779 | "ONLINE" | 0            | "No valid partition" | "No valid partition"   | "{{nebula.release}}" |
      +-------------+------+----------+--------------+----------------------+------------------------+---------+
      ```

    执行两次`exit`可以退出容器。

    5. 使用基本 nGQL 语句。更多信息，请参见[使用常用 nGQL（CRUD 命令）](../../2.quick-start/3.quick-start-on-premise/4.nebula-graph-crud.md)。 

